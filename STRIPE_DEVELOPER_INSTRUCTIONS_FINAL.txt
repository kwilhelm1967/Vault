# ðŸŽ¯ COMPLETE STRIPE SETUP INSTRUCTIONS FOR YOUR DEVELOPER

## OVERVIEW: Trial â†’ Purchase â†’ License Keys â†’ ZIP Download

**Customer Journey:**
1. **Trial Period Ends** - Customer sees "Buy Now" screen in software
2. **User Buys Plan** - Customer pays via Stripe on your website  
3. **User Gets Email with Keys** - Email with unique license keys + download link
4. **Use Keys + Software** - Customer downloads .exe files and activates

---

## STEP 1: CREATE STRIPE PRODUCTS

### Go to Stripe Dashboard â†’ Products â†’ Create Product

**Product 1: Single User**
```
Name: "Local Password Vault - Single User"
Price: $29.00 (one-time payment)
Metadata:
  Key: product_id
  Value: prod_single_user
```

**Product 2: Family Plan**
```
Name: "Local Password Vault - Family Plan"
Price: $49.00 (one-time payment)
Metadata:
  Key: product_id
  Value: prod_family_plan
```

**Product 3: Pro License**
```
Name: "Local Password Vault - Pro"
Price: $68.00 (one-time payment)
Metadata:
  Key: product_id
  Value: prod_pro_license
```

**Product 4: Business Plan**
```
Name: "Local Password Vault - Business Plan"
Price: $99.00 (one-time payment)
Metadata:
  Key: product_id
  Value: prod_business_plan
```

---

## STEP 2: SET UP WEBHOOK

### Go to Stripe Dashboard â†’ Developers â†’ Webhooks â†’ Add Endpoint

**Webhook Configuration:**
```
Endpoint URL: https://your-render-url.onrender.com/webhook/stripe
Description: Local Password Vault License Generator

Events to send:
âœ… checkout.session.completed

That's it - only one event needed!
```

**Get Webhook Secret:**
- After creating webhook, click "Reveal" next to signing secret
- Copy the secret (starts with `whsec_`)
- Save for environment variables

---

## STEP 3: DEPLOY LICENSE SERVER

### Upload These Files to Your Server (Render/Heroku/etc.):
```
server-api-examples/
â”œâ”€â”€ license-server.js           â† Main server file
â”œâ”€â”€ zip-generator.js           â† Creates customer ZIP files
â”œâ”€â”€ download-handler.js        â† Manages secure downloads
â”œâ”€â”€ email-templates.js         â† Sends license emails
â””â”€â”€ package.json              â† Server dependencies
```

### Environment Variables (.env file):
```env
# Stripe Configuration
STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Email Configuration
EMAIL_SERVICE=gmail
EMAIL_USER=your_email@gmail.com
EMAIL_PASS=your_gmail_app_password

# Server Configuration
SERVER_URL=https://your-render-url.onrender.com
PORT=3000
NODE_ENV=production
ALLOWED_ORIGINS=https://yourcarrdsite.com
```

### Start Server:
```bash
npm install
npm start
```

---

## STEP 4: UPLOAD PRE-MADE ZIP FILES

### Create ZIP Files Directory on Server:
```
your-server/downloads/
â”œâ”€â”€ LocalPasswordVault-single-user.zip     # Ready for Single User customers
â”œâ”€â”€ LocalPasswordVault-family-plan.zip     # Ready for Family Plan customers  
â”œâ”€â”€ LocalPasswordVault-pro.zip             # Ready for Pro customers
â””â”€â”€ LocalPasswordVault-business-plan.zip   # Ready for Business customers
```

### Each ZIP Contains (NO SOURCE CODE):
```
LocalPasswordVault-[Plan].zip (5-8 MB)
â”œâ”€â”€ LocalPasswordVault-Setup.exe        # Windows installer
â”œâ”€â”€ LocalPasswordVault-Portable.exe     # Windows portable
â”œâ”€â”€ LocalPasswordVault.dmg              # Mac installer
â”œâ”€â”€ LocalPasswordVault.AppImage         # Linux portable
â”œâ”€â”€ README.txt                          # Plan-specific setup guide
â””â”€â”€ QUICK_START.txt                     # Installation instructions
```

---

## STEP 5: LICENSE KEY GENERATION SYSTEM

### When Customer Purchases, Server Generates:

**Single User ($29):**
```javascript
case 'prod_single_user':
  quantity = 1; // Generate 1 UNIQUE license key
  zipFile = 'LocalPasswordVault-single-user.zip';
  // Customer gets: ABCD-EFGH-IJKL-MNOP + .exe files
```

**Family Plan ($49):**
```javascript
case 'prod_family_plan':
  quantity = 3; // Generate 3 UNIQUE license keys
  zipFile = 'LocalPasswordVault-family-plan.zip';
  // Customer gets:
  // Device 1: ABCD-EFGH-IJKL-MNOP + .exe files
  // Device 2: QRST-UVWX-YZAB-CDEF + .exe files
  // Device 3: GHIJ-KLMN-OPQR-STUV + .exe files
```

**Pro License ($68):**
```javascript
case 'prod_pro_license':
  quantity = 6; // Generate 6 UNIQUE license keys
  zipFile = 'LocalPasswordVault-pro.zip';
  // Customer gets:
  // Device 1: ABCD-EFGH-IJKL-MNOP + .exe files
  // Device 2: QRST-UVWX-YZAB-CDEF + .exe files
  // Device 3: GHIJ-KLMN-OPQR-STUV + .exe files
  // Device 4: WXYZ-ABCD-EFGH-IJKL + .exe files
  // Device 5: MNOP-QRST-UVWX-YZAB + .exe files
  // Device 6: CDEF-GHIJ-KLMN-OPQR + .exe files
```

**Business Plan ($99):**
```javascript
case 'prod_business_plan':
  quantity = 10; // Generate 10 UNIQUE license keys
  zipFile = 'LocalPasswordVault-business-plan.zip';
  // Customer gets: 10 different license keys + .exe files + license server
```

### Key Uniqueness Guaranteed:
- Uses **timestamp + random + checksum**
- **NO two keys are ever the same**
- Generated **instantly upon purchase**

---

## STEP 6: CUSTOMER EMAIL EXAMPLES

### Single User Email:
```
Subject: Your Local Password Vault Single User License

Your License Key: ABCD-EFGH-IJKL-MNOP

Download Your Software:
https://your-server.com/downloads/LocalPasswordVault-single-user.zip
(5 MB - includes Windows/Mac/Linux applications)

What's Included:
- Windows installer and portable app
- Mac installer
- Linux portable app
- Complete setup documentation

Use on: 1 device only
```

### Family Plan Email:
```
Subject: Your Local Password Vault Family Plan License

Your License Keys:
Device 1: ABCD-EFGH-IJKL-MNOP
Device 2: QRST-UVWX-YZAB-CDEF
Device 3: GHIJ-KLMN-OPQR-STUV

Download Your Software:
https://your-server.com/downloads/LocalPasswordVault-family-plan.zip
(5 MB - includes Windows/Mac/Linux applications)

What's Included:
- Windows installer and portable app
- Mac installer
- Linux portable app
- Family sharing setup guides

Use on: 3 devices (different key for each)
```

### Pro Email:
```
Subject: Your Local Password Vault Pro License

Your License Keys:
Device 1: ABCD-EFGH-IJKL-MNOP
Device 2: QRST-UVWX-YZAB-CDEF
Device 3: GHIJ-KLMN-OPQR-STUV
Device 4: WXYZ-ABCD-EFGH-IJKL
Device 5: MNOP-QRST-UVWX-YZAB
Device 6: CDEF-GHIJ-KLMN-OPQR

Download Your Software:
https://your-server.com/downloads/LocalPasswordVault-pro.zip
(5 MB - includes Windows/Mac/Linux applications)

What's Included:
- Windows installer and portable app
- Mac installer
- Linux portable app
- Multi-device setup guides

Use on: 6 devices (different key for each)
```

### Business Email:
```
Subject: Your Local Password Vault Business Plan License

Your License Keys:
Admin: ABCD-EFGH-IJKL-MNOP
User 1: QRST-UVWX-YZAB-CDEF
User 2: GHIJ-KLMN-OPQR-STUV
[... 7 more user keys]

Download Your Software:
https://your-server.com/downloads/LocalPasswordVault-business-plan.zip
(8 MB - includes Windows/Mac/Linux applications + license server)

What's Included:
- Windows installer and portable app
- Mac installer
- Linux portable app
- Pre-built license server
- Enterprise setup guides

Use on: 10 devices
```

---

## STEP 7: SIMPLE SERVER CODE

```javascript
// Complete webhook handler for license-server.js
app.post('/webhook/stripe', express.raw({type: 'application/json'}), async (req, res) => {
  const sig = req.headers['stripe-signature'];
  let event;

  try {
    event = stripe.webhooks.constructEvent(req.body, sig, process.env.STRIPE_WEBHOOK_SECRET);
  } catch (err) {
    console.log(`Webhook signature verification failed: ${err.message}`);
    return res.status(400).send(`Webhook Error: ${err.message}`);
  }

  // Handle one-time purchase
  if (event.type === 'checkout.session.completed') {
    const session = event.data.object;
    const customerEmail = session.customer_details.email;
    const productId = session.metadata?.product_id;
    
    console.log(`Purchase completed for ${customerEmail}, product: ${productId}`);
    
    // Determine ZIP file and license quantity
    let zipFile = '';
    let quantity = 1;
    let price = 29;
    
    switch (productId) {
      case 'prod_single_user':
        zipFile = 'LocalPasswordVault-single-user.zip';
        quantity = 1;
        price = 29;
        break;
      case 'prod_family_plan':
        zipFile = 'LocalPasswordVault-family-plan.zip';
        quantity = 3;
        price = 49;
        break;
      case 'prod_pro_license':
        zipFile = 'LocalPasswordVault-pro.zip';
        quantity = 6;
        price = 68;
        break;
      case 'prod_business_plan':
        zipFile = 'LocalPasswordVault-business-plan.zip';
        quantity = 10;
        price = 99;
        break;
    }
    
    // Generate unique license keys
    const licenseKeys = [];
    for (let i = 0; i < quantity; i++) {
      licenseKeys.push(generateUniqueLicenseKey());
    }
    
    // Send email with keys + link to pre-made ZIP
    await emailService.sendLicenseEmail(
      customerEmail, 
      licenseKeys, 
      zipFile,
      price
    );
    
    console.log(`âœ… SUCCESS: ${quantity} unique license keys sent to ${customerEmail}`);
    console.log(`ðŸ“¦ Download: ${zipFile}`);
    console.log(`ðŸ’° Revenue: $${price}`);
  }

  res.json({received: true});
});

// Generate UNIQUE license key
function generateUniqueLicenseKey() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  const timestamp = Date.now().toString(36).toUpperCase();
  
  let randomPart = '';
  for (let i = 0; i < 8; i++) {
    randomPart += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  
  const combined = (timestamp + randomPart).substring(0, 15);
  
  let result = '';
  for (let i = 0; i < 15; i++) {
    if (i > 0 && i % 4 === 0) {
      result += '-';
    }
    result += combined[i] || chars.charAt(Math.floor(Math.random() * chars.length));
  }
  
  // Add checksum
  let checksum = 0;
  const cleanKey = result.replace(/-/g, '');
  for (let i = 0; i < cleanKey.length; i++) {
    checksum += cleanKey.charCodeAt(i);
  }
  result += (checksum % 36).toString(36).toUpperCase();
  
  return result;
}
```

---

## STEP 8: TESTING THE SYSTEM

### Test with Stripe Test Cards:
```
Success Card: 4242 4242 4242 4242
Expiration: Any future date
CVC: Any 3 digits
```

### Test Each Plan:
1. **Test Single User:** Pay $29 â†’ Get 1 key + single-user ZIP
2. **Test Family Plan:** Pay $49 â†’ Get 3 keys + family-plan ZIP
3. **Test Pro:** Pay $68 â†’ Get 6 keys + pro ZIP
4. **Test Business:** Pay $99 â†’ Get 10 keys + business-plan ZIP

### Verify:
- âœ… Webhook receives payment
- âœ… Correct number of unique keys generated
- âœ… Email sent with keys and download link
- âœ… ZIP file contains only .exe files + docs (NO source code)
- âœ… Customer can activate software with keys

---

## STEP 9: GO LIVE CHECKLIST

### Before Launch:
- [ ] All Stripe products created with correct metadata
- [ ] Webhook endpoint configured and tested
- [ ] License server deployed and running
- [ ] Email service configured and tested
- [ ] All 4 ZIP files uploaded to server
- [ ] Test purchases completed successfully

### Switch to Production:
- [ ] Update Stripe keys to live mode
- [ ] Update webhook endpoint to production URL
- [ ] Test with real payment (small amount)
- [ ] Monitor webhook logs for issues

---

## ðŸŽ¯ SUMMARY FOR YOUR DEVELOPER

**What happens when customer buys:**
1. Customer pays $29/$49/$68/$99 via Stripe
2. Webhook fires to your server
3. Server generates 1/3/6/10 unique license keys
4. Email sent with keys + download link to pre-made ZIP
5. Customer gets .exe files (NO source code)
6. Customer activates with their unique keys

**Key Points:**
- âœ… Every license key is unique (no duplicates)
- âœ… Correct quantity per plan (1/3/6/10)
- âœ… Only .exe files given to customers
- âœ… Your source code stays 100% private
- âœ… Pre-made ZIP files for instant delivery
- âœ… Customers get working software, not code

**Customer gets everything they need to run the password manager independently, but your React/TypeScript source code stays completely protected!**